# [JPA í•µì‹¬ ê°œë…] 1/4 - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì—”í‹°í‹° ìƒëª…ì£¼ê¸°

ğŸ·ï¸ê¸°ìˆ  ì¹´í…Œê³ ë¦¬: JPA, Spring
ğŸ’¡í•µì‹¬í‚¤ì›Œë“œ: #ì˜ì†ì„±ì»¨í…ìŠ¤íŠ¸, #ìºì‹±
ğŸ’¼ ë©´ì ‘ ë¹ˆì¶œë„: ìµœìƒ
âš–ï¸ ì˜ì‚¬ê²°ì •(A vs B): No
ë‚ ì§œ: 2026ë…„ 1ì›” 18ì¼ ì˜¤í›„ 10:22
ğŸ“… ë‹¤ìŒ ë³µìŠµì¼: 2026ë…„ 1ì›” 21ì¼

# 1. Abstract: í•µì‹¬ ìš”ì•½

> **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸(Persistence Context)**ëŠ” JPAì˜ í•µì‹¬ìœ¼ë¡œ, ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ê¸° ì „ì— ë©”ëª¨ë¦¬ì—ì„œ ê´€ë¦¬í•˜ëŠ” **1ì°¨ ìºì‹œ** ê³µê°„ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ **ë³€ê²½ ê°ì§€(Dirty Checking)**, **ë™ì¼ì„± ë³´ì¥**, **ì§€ì—° ë¡œë”©** ë“±ì„ êµ¬í˜„í•˜ì—¬ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ DBë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> 

**í•µì‹¬ ì›ì¹™**:

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ = ì—”í‹°í‹° ê´€ë¦¬ì (EntityManager)
- 1ì°¨ ìºì‹œ: ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë™ì¼ì„± ë³´ì¥
- ì—”í‹°í‹° ìƒëª…ì£¼ê¸°: ë¹„ì˜ì† â†’ ì˜ì† â†’ ì¤€ì˜ì† â†’ ì‚­ì œ

---

# 2. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€?

## 2.1 ê¸°ë³¸ ê°œë…

```java
@Service
public class UserService {
    @PersistenceContext
    private EntityManager em;
    
    @Transactional
    public void example() {
        // 1. ë¹„ì˜ì† ìƒíƒœ (new)
        User user = new User("John", "[john@example.com](mailto:john@example.com)");
        
        // 2. ì˜ì† ìƒíƒœ (persist)
        em.persist(user);  // 1ì°¨ ìºì‹œì— ì €ì¥
        
        // 3. ë™ì¼ì„± ë³´ì¥
        User found = em.find(User.class, user.getId());  // DB ì¡°íšŒ X, 1ì°¨ ìºì‹œì—ì„œ ê°€ì ¸ì˜¤ê¸°
        System.out.println(user == found);  // true!
        
        // 4. ë³€ê²½ ê°ì§€ (Dirty Checking)
        user.changeName("Jane");  // UPDATE ì¿¼ë¦¬ ìë™ ìƒì„±
        
        // 5. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ SQL ì‹¤í–‰
    }
}
```

---

## 2.2 1ì°¨ ìºì‹œ

**ë™ì‘ ë°©ì‹**:

```java
@Transactional
public void cacheExample() {
    // ì²« ë²ˆì§¸ ì¡°íšŒ: DBì—ì„œ SELECT
    User user1 = em.find(User.class, 1L);
    
    // ë‘ ë²ˆì§¸ ì¡°íšŒ: 1ì°¨ ìºì‹œì—ì„œ ê°€ì ¸ì˜¤ê¸° (DB ì¡°íšŒ X)
    User user2 = em.find(User.class, 1L);
    
    // ë™ì¼ì„± ë³´ì¥
    System.out.println(user1 == user2);  // true
}
```

**1ì°¨ ìºì‹œ êµ¬ì¡°**:

```
Persistence Context (1ì°¨ ìºì‹œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key (ID)  | Value (Entity)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1L        | User(id=1, name="A") â”‚
â”‚ 2L        | User(id=2, name="B") â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 3. ì—”í‹°í‹° ìƒëª…ì£¼ê¸°

## 3.1 4ê°€ì§€ ìƒíƒœ

```java
// 1. ë¹„ì˜ì† (Transient)
User user = new User();  // JPAê°€ ëª¨ë¥´ëŠ” ìƒíƒœ

// 2. ì˜ì† (Managed)
em.persist(user);  // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬

// 3. ì¤€ì˜ì† (Detached)
em.detach(user);  // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬
// ë˜ëŠ” íŠ¸ëœì­ì…˜ ì¢…ë£Œ í›„ ìë™ìœ¼ë¡œ ì¤€ì˜ì†

// 4. ì‚­ì œ (Removed)
em.remove(user);  // ì‚­ì œ ëŒ€ìƒ
```

---

## 3.2 ìƒíƒœ ì „ì´ ë‹¤ì´ì–´ê·¸ë¨

```
[ë¹„ì˜ì†]
    â”‚
    â”‚ persist()
    â†“
[ì˜ì†] â”€â†’â”€â†’â”€ detach() â”€â†’â”€â†’â”€ [ì¤€ì˜ì†]
    â”‚                            â”‚
    â”‚ remove()          merge() â”‚
    â†“                            â†“
[ì‚­ì œ]                       [ì˜ì†]
```

---

## 3.3 ìƒíƒœë³„ íŠ¹ì§•

| ìƒíƒœ | ë³€ê²½ ê°ì§€ | 1ì°¨ ìºì‹œ | íŠ¸ëœì­ì…˜ |
| --- | --- | --- | --- |
| **ë¹„ì˜ì†** | X | X | X |
| **ì˜ì†** | O | O | O |
| **ì¤€ì˜ì†** | X | X | X |
| **ì‚­ì œ** | X | X | O |

---

# 4. ë³€ê²½ ê°ì§€ (Dirty Checking)

## 4.1 ìë™ UPDATE

```java
@Transactional
public void updateUser(Long id) {
    User user = em.find(User.class, id);
    
    // âœ… ì—”í‹°í‹° ìˆ˜ì •ë§Œ í•˜ë©´ ëœë‹¤!
    user.changeName("New Name");
    user.changeEmail("[new@email.com](mailto:new@email.com)");
    
    // âŒ em.update(user) ë¶ˆí•„ìš”!
    // íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ ìë™ìœ¼ë¡œ UPDATE SQL ì‹¤í–‰
}

// ì‹¤í–‰ë˜ëŠ” SQL:
// UPDATE user SET name='New Name', [email='new@email.com](mailto:email='new@email.com)' WHERE id=?
```

---

## 4.2 ìŠ¤ëƒ…ìƒ· ë¹„êµ

**ë™ì‘ ì›ë¦¬**:

```
1. ì—”í‹°í‹° ì¡°íšŒ ì‹œ ìŠ¤ëƒ…ìƒ· ì €ì¥
   Original: User(id=1, name="John", email="[john@email.com](mailto:john@email.com)")

2. ì—”í‹°í‹° ìˆ˜ì •
   Current:  User(id=1, name="Jane", email="[jane@email.com](mailto:jane@email.com)")

3. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ ë¹„êµ
   Original vs Current â†’ ë³€ê²½ ê°ì§€

4. UPDATE SQL ì‹¤í–‰
```

---

# 5. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬

## 5.1 í”ŒëŸ¬ì‹œ (flush)

```java
@Transactional
public void flushExample() {
    User user = new User("John");
    em.persist(user);
    
    // âœ… ìˆ˜ë™ í”ŒëŸ¬ì‹œ
    em.flush();  // ì¦‰ì‹œ INSERT SQL ì‹¤í–‰
    
    // íŠ¸ëœì­ì…˜ì€ ì•„ì§ ì»¤ë°‹ ì•ˆ ë¨
}
```

**í”ŒëŸ¬ì‹œ ë°œìƒ ì‹œì **:

1. `em.flush()` ì§ì ‘ í˜¸ì¶œ
2. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ ìë™
3. JPQL ì¿¼ë¦¬ ì‹¤í–‰ ì§ì „

---

## 5.2 ì¤€ì˜ì† ìƒíƒœ

```java
@Transactional
public User getUser(Long id) {
    User user = em.find(User.class, id);
    return user;  // íŠ¸ëœì­ì…˜ ì¢…ë£Œ â†’ ì¤€ì˜ì†
}

public void updateDetached() {
    User user = getUser(1L);  // ì¤€ì˜ì† ìƒíƒœ
    
    user.changeName("New");  // ë³€ê²½ ê°ì§€ X!
    
    // âœ… í•´ê²°ë²• 1: merge
    em.merge(user);  // ì¤€ì˜ì† â†’ ì˜ì†
    
    // âœ… í•´ê²°ë²• 2: @Transactional ë²”ìœ„ í™•ì¥
}
```

---

# 6. ì‹¤ì „ íŒ¨í„´

## 6.1 ì—”í‹°í‹° ì¡°íšŒ íŒ¨í„´

```java
@Service
@RequiredArgsConstructor
public class UserService {
    private final UserRepository userRepository;
    
    // âœ… ì˜ì† ìƒíƒœ ìœ ì§€
    @Transactional(readOnly = true)
    public UserDto getUser(Long id) {
        User user = userRepository.findById(id)
            .orElseThrow();
        
        // ì—”í‹°í‹° â†’ DTO ë³€í™˜ (íŠ¸ëœì­ì…˜ ë‚´ë¶€)
        return new UserDto(user);
    }
    
    // âœ… ë³€ê²½ ê°ì§€ í™œìš©
    @Transactional
    public void updateUser(Long id, String name) {
        User user = userRepository.findById(id)
            .orElseThrow();
        
        user.changeName(name);  // ìë™ UPDATE
        // save() ë¶ˆí•„ìš”!
    }
}
```

---

## 6.2 ë³€ê²½ ê°ì§€ vs save()

```java
// âŒ Bad: ë¶ˆí•„ìš”í•œ save()
@Transactional
public void updateBad(Long id) {
    User user = userRepository.findById(id).orElseThrow();
    user.changeName("New");
    [userRepository.save](http://userRepository.save)(user);  // ë¶ˆí•„ìš”!
}

// âœ… Good: ë³€ê²½ ê°ì§€ í™œìš©
@Transactional
public void updateGood(Long id) {
    User user = userRepository.findById(id).orElseThrow();
    user.changeName("New");  // ìë™ UPDATE
}
```

---

# 7. Interview Readiness

## â–¶ Q1: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€?

**A**: ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ê¸° ì „ì— ë©”ëª¨ë¦¬ì—ì„œ ê´€ë¦¬í•˜ëŠ” **1ì°¨ ìºì‹œ** ê³µê°„ì…ë‹ˆë‹¤. ë™ì¼ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ê°™ì€ ì—”í‹°í‹°ëŠ” í•­ìƒ ë™ì¼í•œ ê°ì²´(==)ë¥¼ ë°˜í™˜í•˜ì—¬ **ë™ì¼ì„±ì„ ë³´ì¥**í•˜ê³ , **ë³€ê²½ ê°ì§€**ë¡œ ìë™ UPDATEë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

## â–¶ Q2: ë³€ê²½ ê°ì§€ê°€ ì‘ë™í•˜ëŠ” ì›ë¦¬ëŠ”?

**A**: JPAëŠ” ì—”í‹°í‹°ë¥¼ ì²˜ìŒ ì¡°íšŒí•  ë•Œ **ìŠ¤ëƒ…ìƒ·(snapshot)**ì„ ì €ì¥í•©ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œì ì— í˜„ì¬ ì—”í‹°í‹° ìƒíƒœì™€ ìŠ¤ëƒ…ìƒ·ì„ ë¹„êµí•˜ì—¬ **ë³€ê²½ì´ ê°ì§€ë˜ë©´ ìë™ìœ¼ë¡œ UPDATE SQLì„ ì‹¤í–‰**í•©ë‹ˆë‹¤.

---

## â–¶ Q3: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ìƒëª…ì£¼ê¸°ëŠ”?

**A**: ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” **íŠ¸ëœì­ì…˜ê³¼ ë™ì¼í•œ ë²”ìœ„**ë¥¼ ê°€ì§‘ë‹ˆë‹¤. íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë˜ë©´ ìƒì„±ë˜ê³ , íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ ë˜ëŠ” ë¡¤ë°±ë˜ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë„ í•¨ê»˜ ì¢…ë£Œë©ë‹ˆë‹¤.

---

## â–¶ Q4: 1ì°¨ ìºì‹œì˜ ì¥ì ì€?

**A**:

1. **ë™ì¼ì„± ë³´ì¥**: ê°™ì€ IDëŠ” ê°™ì€ ê°ì²´ ë°˜í™˜ (==)
2. **ì„±ëŠ¥ í–¥ìƒ**: ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ ì¤‘ë³µ ì¡°íšŒ ë°©ì§€
3. **ì“°ê¸° ì§€ì—°**: INSERT/UPDATEë¥¼ ëª¨ì•„ì„œ í•œ ë²ˆì— ì‹¤í–‰

---

## ğŸ”‘ í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ]  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ = 1ì°¨ ìºì‹œ
- [ ]  ì—”í‹°í‹° 4ê°€ì§€ ìƒíƒœ: ë¹„ì˜ì†/ì˜ì†/ì¤€ì˜ì†/ì‚­ì œ
- [ ]  ë³€ê²½ ê°ì§€ë¡œ ìë™ UPDATE
- [ ]  @Transactional ì•ˆì—ì„œë§Œ ì˜ì† ìƒíƒœ ìœ ì§€
- [ ]  flush()ëŠ” ì»¤ë°‹ì´ ì•„ë‹˜
- [ ]  ì¤€ì˜ì† ìƒíƒœì—ì„  ë³€ê²½ ê°ì§€ X
- [ ]  ìˆ˜ì • ì‹œ save() ë¶ˆí•„ìš”

---

**ì‘ì„±ì¼**: 2026-01-18  

**ë©´ì ‘ ë¹ˆì¶œë„**: â­â­â­â­â­ (ìµœìƒ)