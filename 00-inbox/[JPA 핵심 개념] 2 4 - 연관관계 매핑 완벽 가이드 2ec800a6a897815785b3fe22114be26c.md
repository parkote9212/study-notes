# [JPA í•µì‹¬ ê°œë…] 2/4 - ì—°ê´€ê´€ê³„ ë§¤í•‘ ì™„ë²½ ê°€ì´ë“œ

ğŸ·ï¸ê¸°ìˆ  ì¹´í…Œê³ ë¦¬: JPA, Spring
ğŸ’¡í•µì‹¬í‚¤ì›Œë“œ: #JPA, #ë„ë©”ì¸ì£¼ë„ì„¤ê³„
ğŸ’¼ ë©´ì ‘ ë¹ˆì¶œë„: ìµœìƒ
âš–ï¸ ì˜ì‚¬ê²°ì •(A vs B): No
ë‚ ì§œ: 2026ë…„ 1ì›” 18ì¼ ì˜¤í›„ 10:23
ğŸ“… ë‹¤ìŒ ë³µìŠµì¼: 2026ë…„ 1ì›” 21ì¼

# 1. Abstract

> **ì—°ê´€ê´€ê³„ ë§¤í•‘**ì€ ê°ì²´ ê°„ì˜ ê´€ê³„ë¥¼ DB í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¡œ ë§¤í•‘í•˜ëŠ” JPAì˜ í•µì‹¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤. **ë‹¨ë°©í–¥/ì–‘ë°©í–¥**, **1:N/N:1/1:1/N:M** ê´€ê³„ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì„¤ê³„í•˜ë©´ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ DBë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> 

**í•µì‹¬ ì›ì¹™**:

- ì—°ê´€ê´€ê³„ ì£¼ì¸: ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°
- mappedBy: ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì— ì„¤ì •
- ì–‘ë°©í–¥: ì–‘ìª½ì—ì„œ ëª¨ë‘ ì°¸ì¡° ê°€ëŠ¥

---

# 2. ë‹¨ë°©í–¥ vs ì–‘ë°©í–¥

## 2.1 ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

```java
@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;
    
    private String name;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "team_id")
    private Team team;  // ë‹¨ë°©í–¥: Memberë§Œ Team ì°¸ì¡°
}

@Entity
public class Team {
    @Id @GeneratedValue
    private Long id;
    
    private String name;
    // Teamì€ Member ì°¸ì¡° X
}
```

---

## 2.2 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

```java
@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "team_id")  // ì—°ê´€ê´€ê³„ ì£¼ì¸
    private Team team;
}

@Entity
public class Team {
    @Id @GeneratedValue
    private Long id;
    
    @OneToMany(mappedBy = "team")  // ì—°ê´€ê´€ê³„ ì£¼ì¸ ì§€ì •
    private List<Member> members = new ArrayList<>();
}
```

---

# 3. ë‹¤ì¤‘ì„±

## 3.1 N:1 (ë‹¤ëŒ€ì¼)

```java
// ì—¬ëŸ¬ Memberê°€ í•œ Teamì— ì†í•¨
@Entity
public class Member {
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "team_id")
    private Team team;
}
```

---

## 3.2 1:N (ì¼ëŒ€ë‹¤) - ë¹„ê¶Œì¥

```java
// âŒ 1:N ë‹¨ë°©í–¥ì€ ë¹„ê¶Œì¥ (N:1 ì–‘ë°©í–¥ ì‚¬ìš© ê¶Œì¥)
@Entity
public class Team {
    @OneToMany
    @JoinColumn(name = "team_id")  // ì—­ì„¤ì ìœ¼ë¡œ Teamì´ ì£¼ì¸
    private List<Member> members = new ArrayList<>();
}
```

---

## 3.3 1:1 (ì¼ëŒ€ì¼)

```java
// ì£¼ í…Œì´ë¸” (ì™¸ë˜ í‚¤ ë³´ìœ )
@Entity
public class Member {
    @OneToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "locker_id")
    private Locker locker;
}

// ëŒ€ìƒ í…Œì´ë¸”
@Entity
public class Locker {
    @OneToOne(mappedBy = "locker")
    private Member member;
}
```

---

## 3.4 N:M (ë‹¤ëŒ€ë‹¤) - ì¤‘ê°„ í…Œì´ë¸” í•„ìˆ˜

```java
// âŒ ì§ì ‘ @ManyToMany ì‚¬ìš© ë¹„ê¶Œì¥
@Entity
public class Member {
    @ManyToMany
    @JoinTable(name = "member_product")
    private List<Product> products = new ArrayList<>();
}

// âœ… ì¤‘ê°„ ì—”í‹°í‹° ìƒì„± (ê¶Œì¥)
@Entity
public class Order {
    @ManyToOne
    @JoinColumn(name = "member_id")
    private Member member;
    
    @ManyToOne
    @JoinColumn(name = "product_id")
    private Product product;
    
    private int count;
    private LocalDateTime orderDate;
}
```

---

# 4. ì—°ê´€ê´€ê³„ ì£¼ì¸

## 4.1 ì™¸ë˜ í‚¤ ê´€ë¦¬

```java
@Entity
public class Member {
    @ManyToOne
    @JoinColumn(name = "team_id")  // âœ… ì´ìª½ì´ ì£¼ì¸
    private Team team;
    
    // âœ… íŒ€ ë³€ê²½
    public void changeTeam(Team team) {
        [this.team](http://this.team) = team;
        team.getMembers().add(this);  // ì–‘ë°©í–¥ ë™ê¸°í™”
    }
}

@Entity
public class Team {
    @OneToMany(mappedBy = "team")  // âŒ ì£¼ì¸ X, ì½ê¸°ë§Œ
    private List<Member> members = new ArrayList<>();
}
```

---

# 5. ì‹¤ì „ íŒ¨í„´

## 5.1 ì–‘ë°©í–¥ í¸ì˜ ë©”ì„œë“œ

```java
@Entity
public class Member {
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "team_id")
    private Team team;
    
    // âœ… í¸ì˜ ë©”ì„œë“œ
    public void changeTeam(Team newTeam) {
        // ê¸°ì¡´ íŒ€ ê´€ê³„ ì œê±°
        if ([this.team](http://this.team) != null) {
            [this.team](http://this.team).getMembers().remove(this);
        }
        
        // ìƒˆ íŒ€ ì„¤ì •
        [this.team](http://this.team) = newTeam;
        
        // ìƒˆ íŒ€ì— ë©¤ë²„ ì¶”ê°€
        if (newTeam != null) {
            newTeam.getMembers().add(this);
        }
    }
}
```

---

## 5.2 Cascade ì˜µì…˜

```java
@Entity
public class Parent {
    @OneToMany(mappedBy = "parent", cascade = CascadeType.ALL)
    private List<Child> children = new ArrayList<>();
    
    public void addChild(Child child) {
        children.add(child);
        child.setParent(this);
    }
}

// âœ… Parent ì €ì¥ ì‹œ Child ìë™ ì €ì¥
Parent parent = new Parent();
parent.addChild(new Child());
em.persist(parent);  // Childë„ í•¨ê»˜ ì €ì¥
```

---

## 5.3 orphanRemoval

```java
@Entity
public class Parent {
    @OneToMany(mappedBy = "parent", 
               cascade = CascadeType.ALL,
               orphanRemoval = true)  // ê³ ì•„ ê°ì²´ ì œê±°
    private List<Child> children = new ArrayList<>();
}

// âœ… ë¶€ëª¨ì—ì„œ ì œê±°í•˜ë©´ ìë™ ì‚­ì œ
parent.getChildren().remove(0);  // DELETE SQL ì‹¤í–‰
```

---

# 6. Interview Readiness

## â–¶ Q1: ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ë€?

**A**: **ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°**ì…ë‹ˆë‹¤. ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì—ì„œëŠ” í•œìª½ì„ ì£¼ì¸ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•˜ë©°, **ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìª½ì„ ì£¼ì¸ìœ¼ë¡œ ì„ íƒ**í•©ë‹ˆë‹¤. ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ `mappedBy` ì†ì„±ìœ¼ë¡œ ì£¼ì¸ì„ ì§€ì •í•©ë‹ˆë‹¤.

---

## â–¶ Q2: N:1ê³¼ 1:N ì°¨ì´ëŠ”?

**A**: 

- **N:1**: ë‹¤(ìì‹)ê°€ ì¼(ë¶€ëª¨) ì°¸ì¡°, ì™¸ë˜ í‚¤ê°€ Nìª½ì—
- **1:N**: ì¼(ë¶€ëª¨)ì´ ë‹¤(ìì‹) ì°¸ì¡°, ì™¸ë˜ í‚¤ê°€ Nìª½ì—

**ê¶Œì¥**: N:1 ì–‘ë°©í–¥ ì‚¬ìš© (ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ìª½ì´ ì£¼ì¸)

---

## â–¶ Q3: Cascadeì™€ orphanRemoval ì°¨ì´ëŠ”?

**A**:

- **Cascade**: ë¶€ëª¨ ì—”í‹°í‹° ì—°ì‚°ì´ ìì‹ì—ê²Œ ì „íŒŒ
- **orphanRemoval**: ë¶€ëª¨ì™€ì˜ ê´€ê³„ê°€ ëŠì–´ì§„ ìì‹ ìë™ ì‚­ì œ

---

## ğŸ”‘ í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ]  ì—°ê´€ê´€ê³„ ì£¼ì¸ = ì™¸ë˜ í‚¤ ê´€ë¦¬ì
- [ ]  mappedByëŠ” ì£¼ì¸ ì•„ë‹Œ ìª½ì—
- [ ]  N:1 ì–‘ë°©í–¥ ê¶Œì¥
- [ ]  @ManyToMany ë¹„ê¶Œì¥
- [ ]  ì¤‘ê°„ ì—”í‹°í‹°ë¡œ N:M í‘œí˜„
- [ ]  Cascadeë¡œ ì—°ì‚° ì „íŒŒ
- [ ]  orphanRemovalë¡œ ê³ ì•„ ê°ì²´ ì œê±°

---

**ì‘ì„±ì¼**: 2026-01-18  

**ë©´ì ‘ ë¹ˆì¶œë„**: â­â­â­â­â­ (ìµœìƒ)